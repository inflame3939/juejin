{"ast":null,"code":"var _jsxFileName = \"F:\\\\360Downloads\\\\vs2019\\\\Microsoft VS Code\\\\juejin\\\\juejin-react\\\\src\\\\componments\\\\InfiniteScroll\\\\index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef } from \"react\";\nimport ApiArt from '../ApiArt';\nimport { getArticles } from '../../fake-api';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst THRESHOLD = 15;\n\nconst SlidingWindowScrollHook = props => {\n  _s();\n\n  const [start, setStart] = useState(0);\n  const [end, setEnd] = useState(THRESHOLD);\n  const [observer, setObserver] = useState(null);\n  const $bottomElement = useRef();\n  const $topElement = useRef();\n  const iitem = [0, 1, 2, 3, 4, 5, 6, 7, 8, 9];\n  const offset = 0;\n\n  async function helloAsync() {\n    // const {iitem} = _this.props\n    // const {offset} = _this.props\n    const a = await getArticles(0, 'hot', offset, 10); // console.log(_this.props);\n    // console.log(iitem,a);\n\n    const b = a.data.articles[iitem].author_user_info.user_name; // console.log('aasd',d);\n    // const f = Datetime(a.data.articles[iitem].article_info.ctime*1000)\n\n    const g = a.data.articles[iitem].category_info;\n    const h = a.data.articles[iitem].article_info; // console.log(a.data.articles[0].article_info.ctime);\n    // console.log(g);\n\n    const e = [b, '', '', g, h];\n    return e;\n  }\n\n  helloAsync().then(e => {\n    this.setState({\n      art: e[0],\n      ctime: e[2],\n      cateName: {\n        first_category_name: e[3].first_category_name,\n        second_category_name: e[3].second_category_name\n      },\n      brief_content: e[4].brief_content,\n      title: e[4].title,\n      cover_image: e[4].cover_image,\n      collect_count: e[4].collect_count,\n      digg_count: e[4].digg_count,\n      comment_count: e[4].comment_count,\n      success: true\n    }, () => {\n      console.log(this.state.success);\n    });\n  });\n  useEffect(() => {\n    intiateScrollObserver();\n    return () => {\n      resetObservation();\n    }; // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [start, end]);\n\n  const intiateScrollObserver = () => {\n    const options = {\n      root: null,\n      rootMargin: '0px',\n      threshold: 0.1\n    };\n    const Observer = new IntersectionObserver(callback, options);\n\n    if ($topElement.current) {\n      Observer.observe($topElement.current);\n    }\n\n    if ($bottomElement.current) {\n      Observer.observe($bottomElement.current);\n    }\n\n    setObserver(Observer);\n  };\n\n  const callback = (entries, observer) => {\n    entries.forEach((entry, index) => {\n      // const listLength = props.list.length;\n      const listLength = 45; // Scroll Down\n\n      if (entry.isIntersecting && entry.target.id === \"bottom\") {\n        const maxStartIndex = listLength - 1 - THRESHOLD; // Maximum index value `start` can take\n\n        const maxEndIndex = listLength - 1; // Maximum index value `end` can take\n\n        const newEnd = end + 10 <= maxEndIndex ? end + 10 : maxEndIndex;\n        const newStart = end - 5 <= maxStartIndex ? end - 5 : maxStartIndex;\n        setStart(newStart);\n        setEnd(newEnd);\n      } // Scroll up\n\n\n      if (entry.isIntersecting && entry.target.id === \"top\") {\n        const newEnd = end === THRESHOLD ? THRESHOLD : end - 10 > THRESHOLD ? end - 10 : THRESHOLD;\n        let newStart = start === 0 ? 0 : start - 10 > 0 ? start - 10 : 0;\n        setStart(newStart);\n        setEnd(newEnd);\n      }\n    });\n  };\n\n  const resetObservation = () => {\n    observer && observer.unobserve($bottomElement.current);\n    observer && observer.unobserve($topElement.current);\n  };\n\n  const getReference = (index, isLastIndex) => {\n    if (index === 0) return $topElement;\n    if (isLastIndex) return $bottomElement;\n    return null;\n  };\n\n  const {\n    list,\n    height\n  } = props;\n  const updatedList = list.slice(start, end);\n  const lastIndex = updatedList.length - 1;\n  return /*#__PURE__*/_jsxDEV(\"ul\", {\n    style: {\n      position: 'relative'\n    },\n    children: updatedList.map((item, index) => {\n      const top = height * (index + start) + 'px';\n      const refVal = getReference(index, index === lastIndex);\n      const id = index === 0 ? 'top' : index === lastIndex ? 'bottom' : '';\n      return (// <li className=\"li-card\" key={item.key} style={{top}} ref={refVal} id={id}>{item.value}</li>\n        iitem.map(iitem => {\n          return /*#__PURE__*/_jsxDEV(ApiArt, {\n            iitem: iitem,\n            style: {\n              top\n            },\n            ref: refVal,\n            offset: offset\n          }, iitem, false, {\n            fileName: _jsxFileName,\n            lineNumber: 116,\n            columnNumber: 22\n          }, this);\n        })\n      );\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 108,\n    columnNumber: 5\n  }, this);\n};\n\n_s(SlidingWindowScrollHook, \"4y6P+RbFs94f4isKpONtbZLrNkI=\");\n\n_c = SlidingWindowScrollHook;\nexport { SlidingWindowScrollHook };\n\nvar _c;\n\n$RefreshReg$(_c, \"SlidingWindowScrollHook\");","map":{"version":3,"sources":["F:/360Downloads/vs2019/Microsoft VS Code/juejin/juejin-react/src/componments/InfiniteScroll/index.js"],"names":["React","useState","useEffect","useRef","ApiArt","getArticles","THRESHOLD","SlidingWindowScrollHook","props","start","setStart","end","setEnd","observer","setObserver","$bottomElement","$topElement","iitem","offset","helloAsync","a","b","data","articles","author_user_info","user_name","g","category_info","h","article_info","e","then","setState","art","ctime","cateName","first_category_name","second_category_name","brief_content","title","cover_image","collect_count","digg_count","comment_count","success","console","log","state","intiateScrollObserver","resetObservation","options","root","rootMargin","threshold","Observer","IntersectionObserver","callback","current","observe","entries","forEach","entry","index","listLength","isIntersecting","target","id","maxStartIndex","maxEndIndex","newEnd","newStart","unobserve","getReference","isLastIndex","list","height","updatedList","slice","lastIndex","length","position","map","item","top","refVal"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef } from \"react\";\r\nimport ApiArt from '../ApiArt'\r\nimport { getArticles } from '../../fake-api';\r\n\r\nconst THRESHOLD = 15;\r\n \r\nconst SlidingWindowScrollHook = (props) =>  {\r\n  const [start, setStart] = useState(0);\r\n  const [end, setEnd] = useState(THRESHOLD);\r\n  const [observer, setObserver] = useState(null);\r\n  const $bottomElement = useRef();\r\n  const $topElement = useRef();\r\n  const iitem=[0,1,2,3,4,5,6,7,8,9]; \r\n  const offset = 0;\r\n\r\n  async function helloAsync(){\r\n    // const {iitem} = _this.props\r\n    // const {offset} = _this.props\r\n    const a= await getArticles( 0,  'hot', offset ,  10);\r\n    // console.log(_this.props);\r\n    // console.log(iitem,a);\r\n    const b = a.data.articles[iitem].author_user_info.user_name\r\n    // console.log('aasd',d);\r\n    // const f = Datetime(a.data.articles[iitem].article_info.ctime*1000)\r\n    const g = a.data.articles[iitem].category_info\r\n    const h = a.data.articles[iitem].article_info\r\n    // console.log(a.data.articles[0].article_info.ctime);\r\n    // console.log(g);\r\n    const e = [b,'','',g,h]\r\n    return e\r\n  }\r\n  helloAsync().then((e)=>{\r\n    this.setState({\r\n      art:e[0],ctime:e[2],\r\n      cateName:{\r\n        first_category_name:e[3].first_category_name,\r\n        second_category_name:e[3].second_category_name},\r\n      brief_content:e[4].brief_content,title:e[4].title,cover_image:e[4].cover_image,collect_count:e[4].collect_count,digg_count:e[4].digg_count,comment_count:e[4].comment_count,\r\n      success:true},()=>{console.log(this.state.success)}\r\n    )\r\n  })\r\n  useEffect(() => {\r\n    intiateScrollObserver();\r\n    return () => {\r\n      resetObservation()\r\n  }\r\n  // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  },[start, end])\r\n \r\n  const intiateScrollObserver = () => {\r\n    const options = {\r\n      root: null,\r\n      rootMargin: '0px',\r\n      threshold: 0.1\r\n    };\r\n    const Observer = new IntersectionObserver(callback, options)\r\n    if ($topElement.current) {\r\n      Observer.observe($topElement.current);\r\n    }\r\n    if ($bottomElement.current) {\r\n      Observer.observe($bottomElement.current);\r\n    }\r\n    setObserver(Observer)    \r\n  }\r\n \r\n  const callback = (entries, observer) => {\r\n    entries.forEach((entry, index) => {\r\n      // const listLength = props.list.length;\r\n      const listLength = 45;\r\n      // Scroll Down\r\n      if (entry.isIntersecting && entry.target.id === \"bottom\") {\r\n        const maxStartIndex = listLength - 1 - THRESHOLD;     // Maximum index value `start` can take\r\n        const maxEndIndex = listLength - 1;                   // Maximum index value `end` can take\r\n        const newEnd = (end + 10) <= maxEndIndex ? end + 10 : maxEndIndex;\r\n        const newStart = (end - 5) <= maxStartIndex ? end - 5 : maxStartIndex;\r\n        setStart(newStart)\r\n        setEnd(newEnd)\r\n      }\r\n      // Scroll up\r\n      if (entry.isIntersecting && entry.target.id === \"top\") {\r\n        const newEnd = end === THRESHOLD ? THRESHOLD : (end - 10 > THRESHOLD ? end - 10 : THRESHOLD);\r\n        let newStart = start === 0 ? 0 : (start - 10 > 0 ? start - 10 : 0);\r\n        setStart(newStart)\r\n        setEnd(newEnd)\r\n      }\r\n \r\n    });\r\n  }\r\n  const resetObservation = () => {\r\n    observer && observer.unobserve($bottomElement.current);\r\n    observer && observer.unobserve($topElement.current);\r\n  }\r\n \r\n \r\n  const getReference = (index, isLastIndex) => {\r\n    if (index === 0)\r\n      return $topElement;\r\n    if (isLastIndex) \r\n      return $bottomElement;\r\n    return null;\r\n  }\r\n \r\n  const {list, height} = props;\r\n  const updatedList = list.slice(start, end);\r\n  const lastIndex = updatedList.length - 1;\r\n \r\n  return (\r\n    <ul style={{position: 'relative'}}>\r\n      {updatedList.map((item, index) => {\r\n        const top = (height * (index + start)) + 'px';\r\n        const refVal = getReference(index, index === lastIndex);\r\n        const id = index === 0 ? 'top' : (index === lastIndex ? 'bottom' : '');\r\n        return (\r\n            // <li className=\"li-card\" key={item.key} style={{top}} ref={refVal} id={id}>{item.value}</li>\r\n            iitem.map( iitem=>{\r\n              return <ApiArt iitem={iitem} key={iitem} style={{top}} ref={refVal} offset={offset}></ApiArt>\r\n            })\r\n        );\r\n      })}\r\n    </ul>\r\n  );\r\n}\r\nexport { SlidingWindowScrollHook };\r\n"]},"metadata":{},"sourceType":"module"}